<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Budget Buckets App</title>
  <script src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-50">
  <div id="root"></div>

  <script type="text/babel" data-presets="env,react">
    function App() {
        // ---------- Utils ----------
        const round2 = (n) => Math.round(n * 100) / 100;
        const fmtDate = (d) => new Date(d).toISOString().split("T")[0];
        const currency = (n) => `$${round2(n).toFixed(2)}`;

        // ---------- Load persisted state ----------
        const loadState = (key, fallback) => {
            try {
            const stored = localStorage.getItem(key);
            if (stored) return JSON.parse(stored);
            } catch (e) {}
            return fallback;
        };

        // ---------- Initial State ----------
        const [buckets, setBuckets] = React.useState(
            loadState("buckets", [
            { id: 1, name: "Out to Eat", budgeted: 150, spent: 0, period: "weekly" },
            { id: 2, name: "Groceries", budgeted: 400, spent: 0, period: "monthly" },
            ])
        );
        const [recurringIncome, setRecurringIncome] = React.useState(
            loadState("recurringIncome", [
            { id: 1, name: "Salary", amount: 3000, frequency: "monthly", nextDate: "2025-10-01" },
            { id: 2, name: "Side Hustle", amount: 500, frequency: "weekly", nextDate: "2025-10-05" },
            ])
        );
        const [recurringBills, setRecurringBills] = React.useState(
            loadState("recurringBills", [
            { id: 1, name: "Rent", amount: 1200, frequency: "monthly", dueDay: 1 },
            { id: 2, name: "Phone", amount: 80, frequency: "monthly", dueDay: 15 },
            { id: 3, name: "Car Insurance", amount: 600, frequency: "yearly", dueMonth: 6, dueDay: 15 },
            ])
        );
        const [transactions, setTransactions] = React.useState(loadState("transactions", []));
        const [activeTab, setActiveTab] = React.useState("summary");

        const today = new Date();
        const [selectedMonth, setSelectedMonth] = React.useState(
            loadState("selectedMonth", today.getMonth())
        );
        const [selectedYear, setSelectedYear] = React.useState(
            loadState("selectedYear", today.getFullYear())
        );

        // ---------- Monthly reset ----------
        React.useEffect(() => {
            const now = new Date();
            const lastSeen = localStorage.getItem("lastSeenMonth");
            const current = `${now.getFullYear()}-${now.getMonth() + 1}`;
            if (lastSeen !== current && now.getDate() === 1) {
                setTransactions([]);
                setBuckets((prev) => prev.map((b) => ({ ...b, spent: 0 })));
                localStorage.setItem("lastSeenMonth", current);
            } else if (!lastSeen) {
                localStorage.setItem("lastSeenMonth", current);
            }
        }, []);

        // ---------- Weekly reset for weekly buckets (spent only, not transactions) ----------
        React.useEffect(() => {
            // Only reset on Mondays
            const now = new Date();
            const isMonday = now.getDay() === 1; // 0=Sunday, 1=Monday
            if (!isMonday) return;
            // Week number: ISO week (Monday as first day)
            const getWeekNumber = (d) => {
                d = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
                const dayNum = d.getUTCDay() || 7;
                d.setUTCDate(d.getUTCDate() + 4 - dayNum);
                const yearStart = new Date(Date.UTC(d.getUTCFullYear(),0,1));
                return Math.ceil((((d - yearStart) / 86400000) + 1)/7);
            };
            const currentWeek = `${now.getFullYear()}-W${getWeekNumber(now)}`;
            const lastSeenWeek = localStorage.getItem("lastSeenWeek");
            if (lastSeenWeek !== currentWeek) {
                setBuckets(prev => prev.map(b => b.period === "weekly" ? { ...b, spent: 0 } : b));
                localStorage.setItem("lastSeenWeek", currentWeek);
            }
        }, []);

        // ---------- Persist state ----------
        React.useEffect(() => { localStorage.setItem("buckets", JSON.stringify(buckets)); }, [buckets]);
        React.useEffect(() => { localStorage.setItem("recurringIncome", JSON.stringify(recurringIncome)); }, [recurringIncome]);
        React.useEffect(() => { localStorage.setItem("recurringBills", JSON.stringify(recurringBills)); }, [recurringBills]);
        React.useEffect(() => { localStorage.setItem("transactions", JSON.stringify(transactions)); }, [transactions]);
        React.useEffect(() => { localStorage.setItem("selectedMonth", JSON.stringify(selectedMonth)); }, [selectedMonth]);
        React.useEffect(() => { localStorage.setItem("selectedYear", JSON.stringify(selectedYear)); }, [selectedYear]);

        // ---------- Calendar ----------
        const daysInMonth = new Date(selectedYear, selectedMonth + 1, 0).getDate();
        const weeksInMonth = daysInMonth / 7;

        // ---------- Next due date ----------
        const nextSingleDueDate = (item) => {
            const now = new Date();
            const floorToday = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            if (item.frequency === "monthly") {
                let day = item.dueDay || (item.nextDate ? new Date(item.nextDate).getDate() : 1);
                day = Math.max(1, Math.min(28, day));
                let cand = new Date(now.getFullYear(), now.getMonth(), day);
                if (cand < floorToday) cand = new Date(now.getFullYear(), now.getMonth() + 1, day);
                return fmtDate(cand);
            }
            if (item.frequency === "yearly") {
                let month = item.dueMonth ?? 0;
                let day = item.dueDay ?? 1;
                let cand = new Date(now.getFullYear(), month, day);
                if (cand < floorToday) cand = new Date(now.getFullYear() + 1, month, day);
                return fmtDate(cand);
            }
            if (item.frequency === "weekly") {
                const base = item.nextDate ? new Date(item.nextDate) : new Date(now);
                let cand = new Date(base);
                while (cand < floorToday) cand.setDate(cand.getDate() + 7);
                return fmtDate(cand);
            }
            if (item.frequency === "biweekly") {
                const base = item.nextDate ? new Date(item.nextDate) : new Date(now);
                let cand = new Date(base);
                while (cand < floorToday) cand.setDate(cand.getDate() + 14);
                return fmtDate(cand);
            }
            return item.nextDate || fmtDate(now);
        };

        // ---------- Calendar aware amounts ----------
        const monthlyFromBudget = (b) => (b.period === "weekly" ? round2(b.budgeted * weeksInMonth) : round2(b.budgeted));
        const monthlyFromIncome = (i) => {
            if (i.frequency === "weekly") return round2(i.amount * weeksInMonth);
            if (i.frequency === "biweekly") return round2(i.amount * Math.floor(daysInMonth / 14));
            return round2(i.amount);
        };
        const monthlyFromBill = (b) => {
            if (b.frequency === "weekly") return round2(b.amount * weeksInMonth);
            if (b.frequency === "yearly") return round2(b.amount / 12);
            return round2(b.amount);
        };

        const totalMonthlyIncome = recurringIncome.reduce((s, i) => s + monthlyFromIncome(i), 0);
        const totalMonthlyBills = recurringBills.reduce((s, b) => s + monthlyFromBill(b), 0);
        const totalMonthlyBudgeted = buckets.reduce((s, b) => s + monthlyFromBudget(b), 0);

        // --- Weekly bucket spent calculation ---
        function getLastMonday(d) {
            const date = new Date(d);
            const day = date.getDay();
            const diff = (day === 0 ? -6 : 1) - day; // Monday=1, Sunday=0
            date.setDate(date.getDate() + diff);
            date.setHours(0,0,0,0);
            return date;
        }
        const now = new Date();
        const lastMonday = getLastMonday(now);
        // Calculate spent for each bucket
        const bucketsWithSpent = buckets.map(b => {
            if (b.period === "weekly") {
                // Only sum transactions for this bucket from last Monday to today
                const spent = transactions.filter(t => t.bucketId === b.id && new Date(t.date) >= lastMonday && new Date(t.date) <= now)
                    .reduce((sum, t) => sum + t.amount, 0);
                return { ...b, spent: round2(spent) };
            }
            return b;
        });
        const totalMonthlySpent = bucketsWithSpent.reduce((s, b) => s + b.spent, 0);
        const monthlyRemaining = round2(totalMonthlyIncome - totalMonthlyBills - totalMonthlySpent);
        const projectedRemaining = round2(totalMonthlyIncome - totalMonthlyBills - totalMonthlyBudgeted);

        // ---------- CRUD (Transactions, Buckets, Income, Bills) ----------
        // Always set transaction default date to today
        const todayStr = fmtDate(new Date());
        const [newTransaction, setNewTransaction] = React.useState({ bucketId: "", amount: "", description: "", date: todayStr });
        const addTransaction = () => {
            if (!newTransaction.bucketId || !newTransaction.amount || !newTransaction.description) return;
            const tx = { id: Date.now(), bucketId: parseInt(newTransaction.bucketId), amount: round2(parseFloat(newTransaction.amount)), description: newTransaction.description, date: newTransaction.date };
            setTransactions([...transactions, tx]);
            setBuckets(buckets.map(b => {
                if (b.id !== tx.bucketId) return b;
                // For weekly buckets, spent is recalculated, so just return b
                if (b.period === "weekly") return b;
                return { ...b, spent: round2(b.spent + tx.amount) };
            }));
            setNewTransaction({ bucketId: "", amount: "", description: "", date: fmtDate(new Date()) });
        };
        const deleteTransaction = (id) => {
            const tx = transactions.find(t=>t.id===id); if(!tx) return;
            setBuckets(buckets.map(b=>b.id===tx.bucketId?{...b,spent:Math.max(0,round2(b.spent-tx.amount))}:b));
            setTransactions(transactions.filter(t=>t.id!==id));
        };

        const [newBucket,setNewBucket]=React.useState({name:"",budgeted:"",period:"monthly"});
        const addBucket=()=>{ if(!newBucket.name||!newBucket.budgeted)return; const b={id:Date.now(),...newBucket,budgeted:round2(parseFloat(newBucket.budgeted)),spent:0}; setBuckets([...buckets,b]); setNewBucket({name:"",budgeted:"",period:"monthly"}); };
        const deleteBucket=id=>{ setBuckets(buckets.filter(b=>b.id!==id)); setTransactions(transactions.filter(t=>t.bucketId!==id)); };
        const resetBucket=id=>{ setBuckets(buckets.map(b=>b.id===id?{...b,spent:0}:b)); setTransactions(transactions.filter(t=>t.bucketId!==id)); };

        const [newIncome,setNewIncome]=React.useState({name:"",amount:"",frequency:"monthly",nextDate:""});
        const addIncome=()=>{ if(!newIncome.name||!newIncome.amount)return; setRecurringIncome([...recurringIncome,{id:Date.now(),...newIncome,amount:round2(parseFloat(newIncome.amount))}]); setNewIncome({name:"",amount:"",frequency:"monthly",nextDate:""}); };
        const deleteIncome=id=>setRecurringIncome(recurringIncome.filter(i=>i.id!==id));

        const [newBill,setNewBill]=React.useState({name:"",amount:"",frequency:"monthly",dueDay:"",dueMonth:"",nextDate:""});
        const addBill=()=>{
            if(!newBill.name||!newBill.amount)return;
            let b={id:Date.now(),...newBill,amount:round2(parseFloat(newBill.amount))};
            if(newBill.frequency==="monthly") b.dueDay=parseInt(newBill.dueDay);
            if(newBill.frequency==="yearly") {
                b.dueDay=parseInt(newBill.dueDay);
                b.dueMonth=parseInt(newBill.dueMonth);
            }
            setRecurringBills([...recurringBills,b]);
            setNewBill({name:"",amount:"",frequency:"monthly",dueDay:"",dueMonth:"",nextDate:""});
        };
        const deleteBill=id=>setRecurringBills(recurringBills.filter(b=>b.id!==id));

        // ---------- Edit State for Inline Amount Editing ----------
        const [editBucketId, setEditBucketId] = React.useState(null);
        const [editBucketAmount, setEditBucketAmount] = React.useState("");
        const [editIncomeId, setEditIncomeId] = React.useState(null);
        const [editIncomeAmount, setEditIncomeAmount] = React.useState("");
        const [editBillId, setEditBillId] = React.useState(null);
        const [editBillAmount, setEditBillAmount] = React.useState("");
        const [editTransactionId, setEditTransactionId] = React.useState(null);
        const [editTransactionAmount, setEditTransactionAmount] = React.useState("");

        // ---------- UI helpers ----------
        const getProgressColor=(spent,budgeted)=>{const pct=(spent/budgeted)*100; if(pct>=100) return "bg-red-500"; if(pct>=80) return "bg-yellow-500"; return "bg-green-500";};
        const Chip = ({text,color="blue"}) => (<span className={`inline-block text-xs px-2 py-0.5 rounded-full bg-${color}-100 text-${color}-700 border border-${color}-200`}>{text}</span>);

        // ---------- Download summary ----------
        const downloadMonthlySummary = () => {
            const label = new Date(selectedYear, selectedMonth).toLocaleDateString("en-US", { month: "long", year: "numeric" });
            let txt = `MONTHLY SUMMARY - ${label}\n\n`;
            // INCOME
            txt += "INCOME (for the month):\n";
            recurringIncome.forEach(i => {
                txt += `- ${i.name}: $${monthlyFromIncome(i).toFixed(2)} (${i.frequency}`;
                if (i.nextDate) txt += `, Next: ${nextSingleDueDate(i)}`;
                txt += `)\n`;
            });
            txt += `Total Income: $${totalMonthlyIncome.toFixed(2)}\n\n`;

            // BUCKETS
            txt += "BUCKETS (Budget, Spent, Remaining):\n";
            bucketsWithSpent.forEach(b => {
                const m = monthlyFromBudget(b);
                const spent = b.spent;
                const remaining = m - spent;
                // List all transactions for this bucket (weekly: only from last Monday)
                let txs = transactions.filter(t => t.bucketId === b.id);
                if (b.period === "weekly") {
                    txs = txs.filter(t => new Date(t.date) >= lastMonday && new Date(t.date) <= now);
                }
                txt += `- ${b.name}:\n`;
                txt += `    Budgeted: $${m.toFixed(2)} (${b.period})\n`;
                txt += `    Spent: $${spent.toFixed(2)}\n`;
                txt += `    Remaining: $${remaining.toFixed(2)}\n`;
                if (txs.length > 0) {
                    txt += `    Transactions:\n`;
                    txs.forEach(t => {
                        txt += `      - ${t.date}: $${t.amount.toFixed(2)} - ${t.description}\n`;
                    });
                }
            });
            txt += `Total Budgeted: $${totalMonthlyBudgeted.toFixed(2)}\nTotal Spent: $${totalMonthlySpent.toFixed(2)}\n\n`;

            // BILLS
            txt += "BILLS (for the month):\n";
            recurringBills.forEach(b => {
                txt += `- ${b.name}: $${monthlyFromBill(b).toFixed(2)} (${b.frequency}`;
                if (b.frequency === "monthly" && b.dueDay) txt += `, Due Day: ${b.dueDay}`;
                if (b.frequency === "yearly" && b.dueMonth && b.dueDay) txt += `, Due: ${b.dueMonth}/${b.dueDay}`;
                if (b.frequency === "weekly" && b.nextDate) txt += `, Anchor: ${b.nextDate}`;
                txt += `, Next: ${nextSingleDueDate(b)}`;
                txt += ")\n";
            });
            txt += `Total Bills: $${totalMonthlyBills.toFixed(2)}\n\n`;

            // OVERVIEW
            txt += "OVERVIEW:\n";
            txt += `Remaining Now: $${monthlyRemaining.toFixed(2)}\n`;
            txt += `If All Budgets Spent: $${projectedRemaining.toFixed(2)}\n`;

            const blob = new Blob([txt], { type: "text/plain" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = `summary-${selectedYear}-${String(selectedMonth + 1).padStart(2, "0")}.txt`;
            a.click();
            URL.revokeObjectURL(url);
        };

        // ---------- Render ----------
    return (
        <div className="min-h-screen bg-gradient-to-br from-indigo-50 via-sky-50 to-emerald-50">
        <div className="max-w-6xl mx-auto p-2 sm:p-4 md:p-6">
            <header className="flex items-center justify-between mb-4 sm:mb-6">
            <h1 className="text-2xl sm:text-3xl font-extrabold text-slate-800">💰 Budget Buckets</h1>
            <div className="flex flex-wrap items-center gap-2">
                <select
                value={selectedMonth}
                onChange={(e)=>setSelectedMonth(parseInt(e.target.value))}
                className="border rounded px-2 py-1 bg-white shadow-sm text-sm min-w-[110px]"
                >
                {Array.from({length:12},(_,i)=>
                    <option key={i} value={i}>{new Date(2000,i).toLocaleString("en-US",{month:"long"})}</option>
                )}
                </select>
                <input
                type="number"
                value={selectedYear}
                onChange={(e)=>setSelectedYear(parseInt(e.target.value))}
                className="border rounded px-2 py-1 w-20 sm:w-24 bg-white shadow-sm text-sm"
                />
                <button onClick={downloadMonthlySummary} className="ml-0 sm:ml-2 bg-indigo-600 hover:bg-indigo-700 text-white px-3 py-1 rounded shadow text-sm"> 
                Download Summary
                </button>
            </div>
            </header>

            <nav className="flex flex-wrap gap-2 mb-4 sm:mb-6">
            {["summary","buckets","income","bills","transactions"].map(tab=>
                <button
                key={tab}
                onClick={()=>setActiveTab(tab)}
                className={`px-3 py-1 rounded-full text-sm shadow ${activeTab===tab?"bg-indigo-600 text-white":"bg-white text-slate-700 hover:bg-slate-50"}`}
                >
                {tab.charAt(0).toUpperCase()+tab.slice(1)}
                </button>
            )}
            </nav>

            {activeTab==="summary" && (
            <section>
                <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 mb-4 sm:mb-6">
                <div className="bg-white rounded-xl shadow p-3 sm:p-4 border border-slate-100">
                    <div className="text-slate-500 text-sm">Income</div>
                    <div className="text-2xl font-semibold text-slate-800">{currency(totalMonthlyIncome)}</div>
                </div>
                <div className="bg-white rounded-xl shadow p-3 sm:p-4 border border-slate-100">
                    <div className="text-slate-500 text-sm">Bills</div>
                    <div className="text-2xl font-semibold text-rose-600">-{currency(totalMonthlyBills).slice(1)}</div>
                </div>
                <div className="bg-white rounded-xl shadow p-3 sm:p-4 border border-slate-100">
                    <div className="text-slate-500 text-sm">Spent</div>
                    <div className="text-2xl font-semibold text-rose-600">-{currency(totalMonthlySpent).slice(1)}</div>
                </div>
                <div className="bg-white rounded-xl shadow p-3 sm:p-4 border border-slate-100">
                    <div className="text-slate-500 text-sm">Remaining Now</div>
                    <div className={`text-2xl font-semibold ${monthlyRemaining>=0?"text-emerald-600":"text-rose-600"}`}>{currency(monthlyRemaining)}</div>
                </div>
                </div>

                <div className="bg-white rounded-xl shadow p-3 sm:p-4 border border-slate-100">
                <div className="flex items-center justify-between">
                    <div className="text-slate-700 font-semibold">If All Budgets Spent</div>
                    <div className={`text-lg font-bold ${projectedRemaining>=0?"text-emerald-600":"text-rose-600"}`}>{currency(projectedRemaining)}</div>
                </div>
                <div className="text-xs text-slate-500 mt-2">{daysInMonth} days · {weeksInMonth.toFixed(2)} weeks</div>
                </div>
            </section>
            )}

            {activeTab==="buckets" && (
            <section>
                <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4 mb-4 sm:mb-6">
                {bucketsWithSpent.map((b)=>{
                    const pct = Math.min(100,(b.spent/b.budgeted)*100);
                    const remaining = round2(b.budgeted - b.spent);
                    return (
                    <div key={b.id} className="bg-white rounded-xl shadow p-3 sm:p-4 border border-slate-100">
                        <div className="flex items-center justify-between mb-1">
                        <h3 className="font-semibold text-slate-800">{b.name}</h3>
                        <span className={`text-xs px-2 py-0.5 rounded-full ${b.period==='weekly'?'bg-sky-100 text-sky-700':'bg-emerald-100 text-emerald-700'}`}>{b.period}</span>
                        </div>
                        <div className="flex items-center justify-between text-sm text-slate-600 mb-2">
                        <div>Spent: <span className="font-medium text-slate-800">{currency(b.spent)}</span></div>
                        <div>Budget: {editBucketId === b.id ? (
                            <>
                            <input type="number" className="border rounded px-1 py-0.5 text-sm w-20 mr-1" value={editBucketAmount} onChange={e=>setEditBucketAmount(e.target.value)} />
                            <button className="text-xs text-indigo-600 font-semibold mr-1" onClick={()=>{
                                setBuckets(buckets.map(bk => bk.id === b.id ? { ...bk, budgeted: round2(parseFloat(editBucketAmount)) } : bk));
                                setEditBucketId(null);}}>Save</button>
                            <button className="text-xs text-slate-400" onClick={()=>setEditBucketId(null)}>Cancel</button>
                            </>
                        ) : (
                            <span className="font-medium text-slate-800 cursor-pointer underline decoration-dotted" onClick={()=>{setEditBucketId(b.id);setEditBucketAmount(b.budgeted);}}>{currency(b.budgeted)}</span>
                        )}</div>
                        </div>
                        <div className="w-full bg-slate-100 h-2 rounded overflow-hidden">
                        <div className={`${getProgressColor(b.spent,b.budgeted)} h-2`} style={{ width: `${pct}%` }} />
                        </div>
                        <div className="mt-2 text-sm">
                        <span className={`${remaining>=0?'text-emerald-600':'text-rose-600'} font-medium`}>{currency(remaining)}</span>
                        <span className="text-slate-500"> {remaining>=0? 'left' : 'over'}</span>
                        </div>
                        <div className="mt-3 flex items-center justify-between">
                        <div className="text-xs text-slate-500">Monthly (calendar-aware): <span className="font-semibold text-slate-700">{currency(monthlyFromBudget(b))}</span></div>
                        <div className="flex gap-2">
                            <button onClick={()=>resetBucket(b.id)} className="px-2 py-1 text-xs rounded bg-sky-100 text-sky-700 hover:bg-sky-200">Reset</button>
                            <button onClick={()=>deleteBucket(b.id)} className="px-2 py-1 text-xs rounded bg-rose-100 text-rose-700 hover:bg-rose-200">Delete</button>
                        </div>
                        </div>
                    </div>
                    );
                })}
                </div>

                <div className="bg-white rounded-xl shadow p-3 sm:p-4 border border-slate-100">
                <h3 className="font-semibold text-slate-800 mb-3">Add Bucket</h3>
                <form className="flex flex-col gap-3 sm:flex-row sm:items-end sm:gap-2" onSubmit={e => {e.preventDefault();addBucket();}}>
                    <div className="flex flex-col gap-1 w-full max-w-[160px]">
                        <label className="text-xs text-slate-600 font-medium">Name</label>
                        <input className="border rounded px-2 py-1 text-sm w-full" placeholder="Name" value={newBucket.name} onChange={(e)=>setNewBucket({...newBucket,name:e.target.value})} />
                    </div>
                    <div className="flex flex-col gap-1 w-full max-w-[120px]">
                        <label className="text-xs text-slate-600 font-medium">Amount</label>
                        <input type="number" className="border rounded px-2 py-1 text-sm w-full" placeholder="Amount" value={newBucket.budgeted} onChange={(e)=>setNewBucket({...newBucket,budgeted:e.target.value})} />
                    </div>
                    <div className="flex flex-col gap-1 w-full max-w-[120px]">
                        <label className="text-xs text-slate-600 font-medium">Period</label>
                        <select className="border rounded px-2 py-1 text-sm w-full" value={newBucket.period} onChange={(e)=>setNewBucket({...newBucket,period:e.target.value})}>
                            <option value="monthly">Monthly</option>
                            <option value="weekly">Weekly</option>
                        </select>
                    </div>
                    <button type="submit" className="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-md font-semibold shadow-sm text-sm w-full sm:w-auto transition-colors duration-150">Add</button>
                </form>
                </div>
            </section>
            )}

            {activeTab==="income" && (
            <section>
                <div className="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4 mb-4 sm:mb-6">
                <div className="bg-white rounded-xl shadow p-3 sm:p-4 border border-slate-100">
                    <h3 className="font-semibold text-slate-800 mb-3">Recurring Income</h3>
                    <div className="space-y-3">
                    {recurringIncome.map((i)=> {
                        return (
                        <div key={i.id} className="flex items-center justify-between p-3 rounded border border-slate-100 bg-slate-50">
                            <div>
                                <div className="font-medium text-slate-800">{i.name} <span className="text-slate-500 font-normal">· {editIncomeId === i.id ? (
                                    <>
                                    <input type="number" className="border rounded px-1 py-0.5 text-xs w-16 mr-1" value={editIncomeAmount} onChange={e=>setEditIncomeAmount(e.target.value)} />
                                    <button className="text-xs text-indigo-600 font-semibold mr-1" onClick={()=>{
                                        setRecurringIncome(recurringIncome.map(inc => inc.id === i.id ? { ...inc, amount: round2(parseFloat(editIncomeAmount)) } : inc));
                                        setEditIncomeId(null);}}>Save</button>
                                    <button className="text-xs text-slate-400" onClick={()=>setEditIncomeId(null)}>Cancel</button>
                                    </>
                                ) : (
                                    <span className="cursor-pointer underline decoration-dotted" onClick={()=>{setEditIncomeId(i.id);setEditIncomeAmount(i.amount);}}>{currency(i.amount)}</span>
                                )}</span></div>
                                <div className="text-xs text-slate-500">{i.frequency} · Next: <span className="font-medium text-slate-700">{nextSingleDueDate(i)}</span></div>
                            </div>
                            <button onClick={()=>deleteIncome(i.id)} className="px-2 py-1 text-xs rounded bg-rose-100 text-rose-700 hover:bg-rose-200">Delete</button>
                        </div>
                        );
                    })}
                    </div>
                </div>
                <div className="bg-white rounded-xl shadow p-3 sm:p-4 border border-slate-100">
                    <h3 className="font-semibold text-slate-800 mb-3">Add Income</h3>
                    <form className="flex flex-col gap-3 sm:flex-row sm:items-end sm:gap-2" onSubmit={e => {e.preventDefault();addIncome();}}>
                        <div className="flex flex-col gap-1 w-full max-w-[160px]">
                            <label className="text-xs text-slate-600 font-medium">Name</label>
                            <input className="border rounded px-2 py-1 text-sm w-full" placeholder="Name" value={newIncome.name} onChange={(e)=>setNewIncome({...newIncome,name:e.target.value})} />
                        </div>
                        <div className="flex flex-col gap-1 w-full max-w-[120px]">
                            <label className="text-xs text-slate-600 font-medium">Amount</label>
                            <input type="number" className="border rounded px-2 py-1 text-sm w-full" placeholder="Amount" value={newIncome.amount} onChange={(e)=>setNewIncome({...newIncome,amount:e.target.value})} />
                        </div>
                        <div className="flex flex-col gap-1 w-full max-w-[120px]">
                            <label className="text-xs text-slate-600 font-medium">Frequency</label>
                            <select className="border rounded px-2 py-1 text-sm w-full" value={newIncome.frequency} onChange={(e)=>setNewIncome({...newIncome,frequency:e.target.value})}>
                                <option value="monthly">Monthly</option>
                                <option value="weekly">Weekly</option>
                                <option value="biweekly">Bi-weekly</option>
                            </select>
                        </div>
                        <div className="flex flex-col gap-1 w-full max-w-[140px]">
                            <label className="text-xs text-slate-600 font-medium">Next Date</label>
                            <input type="date" className="border rounded px-2 py-1 text-sm w-full" value={newIncome.nextDate} onChange={(e)=>setNewIncome({...newIncome,nextDate:e.target.value})} />
                        </div>
                        <button type="submit" className="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-md font-semibold shadow-sm text-sm w-full sm:w-auto transition-colors duration-150">Add Income</button>
                    </form>
                    <div className="text-xs text-slate-500 mt-2">Tip: Set a next date to anchor weekly/bi-weekly cycles.</div>
                </div>
                </div>
            </section>
            )}

            {activeTab==="bills" && (
            <section>
                <div className="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4 mb-4 sm:mb-6">
                <div className="bg-white rounded-xl shadow p-3 sm:p-4 border border-slate-100">
                    <h3 className="font-semibold text-slate-800 mb-3">Recurring Bills</h3>
                    <div className="space-y-3">
                    {recurringBills.map((b)=> {
                        return (
                        <div key={b.id} className="flex items-center justify-between p-3 rounded border border-slate-100 bg-slate-50">
                            <div>
                                <div className="font-medium text-slate-800">{b.name} <span className="text-slate-500 font-normal">· {editBillId === b.id ? (
                                    <>
                                    <input type="number" className="border rounded px-1 py-0.5 text-xs w-16 mr-1" value={editBillAmount} onChange={e=>setEditBillAmount(e.target.value)} />
                                    <button className="text-xs text-indigo-600 font-semibold mr-1" onClick={()=>{
                                        setRecurringBills(recurringBills.map(bill => bill.id === b.id ? { ...bill, amount: round2(parseFloat(editBillAmount)) } : bill));
                                        setEditBillId(null);}}>Save</button>
                                    <button className="text-xs text-slate-400" onClick={()=>setEditBillId(null)}>Cancel</button>
                                    </>
                                ) : (
                                    <span className="cursor-pointer underline decoration-dotted" onClick={()=>{setEditBillId(b.id);setEditBillAmount(b.amount);}}>{currency(b.amount)}</span>
                                )}</span></div>
                                <div className="text-xs text-slate-500">{b.frequency} · Next: <span className="font-medium text-slate-700">{nextSingleDueDate(b)}</span></div>
                            </div>
                            <button onClick={()=>deleteBill(b.id)} className="px-2 py-1 text-xs rounded bg-rose-100 text-rose-700 hover:bg-rose-200">Delete</button>
                        </div>
                        );
                    })}
                    </div>
                </div>
                <div className="bg-white rounded-xl shadow p-3 sm:p-4 border border-slate-100">
                    <h3 className="font-semibold text-slate-800 mb-3">Add Bill</h3>
                    <form className="flex flex-col gap-3 sm:flex-row sm:items-end sm:gap-2" onSubmit={e => {e.preventDefault();addBill();}}>
                        <div className="flex flex-col gap-1 w-full max-w-[160px]">
                            <label className="text-xs text-slate-600 font-medium">Name</label>
                            <input className="border rounded px-2 py-1 text-sm w-full" placeholder="Name" value={newBill.name} onChange={(e)=>setNewBill({...newBill,name:e.target.value})} />
                        </div>
                        <div className="flex flex-col gap-1 w-full max-w-[120px]">
                            <label className="text-xs text-slate-600 font-medium">Amount</label>
                            <input type="number" className="border rounded px-2 py-1 text-sm w-full" placeholder="Amount" value={newBill.amount} onChange={(e)=>setNewBill({...newBill,amount:e.target.value})} />
                        </div>
                        <div className="flex flex-col gap-1 w-full max-w-[120px]">
                            <label className="text-xs text-slate-600 font-medium">Frequency</label>
                            <select className="border rounded px-2 py-1 text-sm w-full" value={newBill.frequency} onChange={(e)=>setNewBill({...newBill,frequency:e.target.value})}>
                                <option value="monthly">Monthly</option>
                                <option value="weekly">Weekly</option>
                                <option value="yearly">Yearly</option>
                            </select>
                        </div>
                        {newBill.frequency === 'monthly' && (
                            <div className="flex flex-col gap-1 w-full max-w-[120px]">
                                <label className="text-xs text-slate-600 font-medium">Due day (1-28)</label>
                                <input type="number" className="border rounded px-2 py-1 text-sm w-full" placeholder="Due day (1-28)" value={newBill.dueDay} onChange={(e)=>setNewBill({...newBill,dueDay:e.target.value})} />
                            </div>
                        )}
                        {newBill.frequency === 'weekly' && (
                            <div className="flex flex-col gap-1 w-full max-w-[140px]">
                                <label className="text-xs text-slate-600 font-medium">Anchor Date</label>
                                <input type="date" className="border rounded px-2 py-1 text-sm w-full" value={newBill.nextDate} onChange={(e)=>setNewBill({...newBill,nextDate:e.target.value})} />
                            </div>
                        )}
                        {newBill.frequency === 'yearly' && (
                            <>
                            <div className="flex flex-col gap-1 w-full max-w-[100px]">
                                <label className="text-xs text-slate-600 font-medium">Due month (1-12)</label>
                                <input type="number" className="border rounded px-2 py-1 text-sm w-full" placeholder="Due month (1-12)" value={newBill.dueMonth} onChange={(e)=>setNewBill({...newBill,dueMonth:e.target.value})} />
                            </div>
                            <div className="flex flex-col gap-1 w-full max-w-[100px]">
                                <label className="text-xs text-slate-600 font-medium">Due day (1-28)</label>
                                <input type="number" className="border rounded px-2 py-1 text-sm w-full" placeholder="Due day (1-28)" value={newBill.dueDay} onChange={(e)=>setNewBill({...newBill,dueDay:e.target.value})} />
                            </div>
                            </>
                        )}
                        <button type="submit" className="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-md font-semibold shadow-sm text-sm w-full sm:w-auto transition-colors duration-150">Add Bill</button>
                    </form>
                    <div className="text-xs text-slate-500 mt-2">Monthly bills: choose a due day (1–28). Weekly bills: set an anchor date.</div>
                </div>
                </div>
            </section>
            )}

            {activeTab==="transactions" && (
            <section>
                <div className="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-6">
                <div className="bg-white rounded-xl shadow p-3 sm:p-4 border border-slate-100">
                    <h3 className="font-semibold text-slate-800 mb-3">Transactions</h3>
                    <div className="space-y-3">
                    {transactions.map((t)=> {
                        return (
                        <div key={t.id} className="flex items-center justify-between p-3 rounded border border-slate-100 bg-slate-50">
                            <div>
                                <div className="font-medium text-slate-800">{t.description} <span className="text-slate-500 font-normal">· {editTransactionId === t.id ? (
                                    <>
                                    <input type="number" className="border rounded px-1 py-0.5 text-xs w-16 mr-1" value={editTransactionAmount} onChange={e=>setEditTransactionAmount(e.target.value)} />
                                    <button className="text-xs text-indigo-600 font-semibold mr-1" onClick={()=>{
                                        setTransactions(transactions.map(tx => tx.id === t.id ? { ...tx, amount: round2(parseFloat(editTransactionAmount)) } : tx));
                                        setEditTransactionId(null);}}>Save</button>
                                    <button className="text-xs text-slate-400" onClick={()=>setEditTransactionId(null)}>Cancel</button>
                                    </>
                                ) : (
                                    <span className="cursor-pointer underline decoration-dotted" onClick={()=>{setEditTransactionId(t.id);setEditTransactionAmount(t.amount);}}>{currency(t.amount)}</span>
                                )}</span></div>
                                <div className="text-xs text-slate-500">{t.date} · {buckets.find(b=>b.id===t.bucketId)?.name}</div>
                            </div>
                            <button onClick={()=>deleteTransaction(t.id)} className="px-2 py-1 text-xs rounded bg-rose-100 text-rose-700 hover:bg-rose-200">Delete</button>
                        </div>
                        );
                    })}
                    </div>
                </div>
                <div className="bg-white rounded-xl shadow p-3 sm:p-4 border border-slate-100">
                    <h3 className="font-semibold text-slate-800 mb-3">Add Transaction</h3>
                    <form className="flex flex-col gap-3 sm:flex-row sm:items-end sm:gap-2" onSubmit={e => {e.preventDefault();addTransaction();}}>
                        <div className="flex flex-col gap-1 w-full max-w-[140px]">
                            <label className="text-xs text-slate-600 font-medium">Bucket</label>
                            <select className="border rounded px-2 py-1 text-sm w-full" value={newTransaction.bucketId} onChange={(e)=>setNewTransaction({...newTransaction,bucketId:e.target.value})}>
                                <option value="">Select Bucket</option>
                                {buckets.map(b=> <option key={b.id} value={b.id}>{b.name}</option>)}
                            </select>
                        </div>
                        <div className="flex flex-col gap-1 w-full max-w-[100px]">
                            <label className="text-xs text-slate-600 font-medium">Amount</label>
                            <input type="number" className="border rounded px-2 py-1 text-sm w-full" placeholder="Amount" value={newTransaction.amount} onChange={(e)=>setNewTransaction({...newTransaction,amount:e.target.value})} />
                        </div>
                        <div className="flex flex-col gap-1 w-full max-w-[140px]">
                            <label className="text-xs text-slate-600 font-medium">Description</label>
                            <input className="border rounded px-2 py-1 text-sm w-full" placeholder="Description" value={newTransaction.description} onChange={(e)=>setNewTransaction({...newTransaction,description:e.target.value})} />
                        </div>
                        <div className="flex flex-col gap-1 w-full max-w-[140px]">
                            <label className="text-xs text-slate-600 font-medium">Date</label>
                            <input type="date" className="border rounded px-2 py-1 text-sm w-full" value={newTransaction.date} onChange={(e)=>setNewTransaction({...newTransaction,date:e.target.value})} />
                        </div>
                        <button type="submit" className="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-md font-semibold shadow-sm text-sm w-full sm:w-auto transition-colors duration-150">Add</button>
                    </form>
                </div>
                </div>
            </section>
            )}

            </div>
        </div>
    );
    }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
